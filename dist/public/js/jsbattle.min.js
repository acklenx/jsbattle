var JsBattle=function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=12)}([function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},o=function(t){return t&&t.__esModule?t:{default:t}}(n(11));var a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._model=t,n._view=new PIXI.Container,n._create(n._view),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),i(e,[{key:"update",value:function(t){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,t),void 0!==this._model.x&&(this._view.x=this._model.x),void 0!==this._model.y&&(this._view.y=this._model.y),void 0!==this._model.angle&&(this._view.rotation=this._model.angle*(Math.PI/180))}},{key:"destroy",value:function(){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this.view.parent&&this.view.parent.removeChild(this.view)}},{key:"_create",value:function(t){}}]),e}();e.default=a},function(t,e,n){"use strict";t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){(function(e){t.exports=e}).call(e,{})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},o=function(t){return t&&t.__esModule?t:{default:t}}(n(1));var a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._hudView=new PIXI.Container,n._createHud(n._hudView),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),i(e,[{key:"update",value:function(t){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,t),this.view.rotation=0,this.body.rotation=this.model.angle*(Math.PI/180),this.gun.rotation=(this.model.angle+this.model.gunAngle)*(Math.PI/180),this.radar.rotation=(this.model.angle+this.model.radarAngle)*(Math.PI/180),this.energyBar.scale.x=this.model.energy/this.model.maxEnergy,this.label.text=this.model.fullName,this.hudView.x=this.view.x,this.hudView.y=this.view.y;for(var n=0;n<t.length;n++)this._onEvent(t[n])}},{key:"_onEvent",value:function(t){switch(t.type){case"shoot":this._onShoot(t);break;case"destroy":this._onDestroy(t)}}},{key:"_onShoot",value:function(t){}},{key:"_onDestroy",value:function(t){this.destroy()}},{key:"_create",value:function(t){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_create",this).call(this,t),this._body=this._createBody(),this._gun=this._createGun(),this._radar=this._createRadar(),t.addChild(this._body),t.addChild(this._gun),t.addChild(this._radar)}},{key:"_createHud",value:function(t){this._label=this._createLabel(),this._energyBar=this._createEnergyBar(),t.addChild(this._createHudBackground()),t.addChild(this._energyBar),t.addChild(this._label)}},{key:"_createBody",value:function(){return new PIXI.Sprite}},{key:"_createGun",value:function(){return new PIXI.Sprite}},{key:"_createRadar",value:function(){return new PIXI.Sprite}},{key:"_createHudBackground",value:function(){return new PIXI.Sprite}},{key:"_createEnergyBar",value:function(){return new PIXI.Sprite}},{key:"_createLabel",value:function(){return new PIXI.Text}},{key:"destroy",value:function(){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this.hudView.parent&&this.hudView.parent.removeChild(this.hudView)}},{key:"body",get:function(){return this._body}},{key:"hudView",get:function(){return this._hudView}},{key:"gun",get:function(){return this._gun}},{key:"radar",get:function(){return this._radar}},{key:"label",get:function(){return this._label}},{key:"energyBar",get:function(){return this._energyBar}}]),e}();e.default=a},function(t,e,n){"use strict";var i=n(15),r=n(16),o=n(17),a=n(18),s=n(19),l=n(20),u=n(21);u.alea=i,u.xor128=r,u.xorwow=o,u.xorshift7=a,u.xor4096=s,u.tychei=l,t.exports=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return i(t,[{key:"initBatlefield",value:function(t){}},{key:"preRender",value:function(){}},{key:"postRender",value:function(){}},{key:"renderTank",value:function(t,e){}},{key:"renderClock",value:function(t,e){}},{key:"renderTankStats",value:function(t){}},{key:"renderBullet",value:function(t,e){}},{key:"setSpeed",value:function(t){}},{key:"stop",value:function(){}},{key:"quality",get:function(){return 1},set:function(t){}}]),t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},o=u(n(34)),a=u(n(1)),s=u(n(4)),l=u(n(35));function u(t){return t&&t.__esModule?t:{default:t}}var c=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(n._name=t,"undefined"==typeof PIXI)throw"Pixi.js is required!";return n._masterContainer=new PIXI.Container,n._tankContainer=new PIXI.Container,n._bulletContainer=new PIXI.Container,n._hudContainer=new PIXI.Container,n._masterContainer.addChild(n._tankContainer),n._masterContainer.addChild(n._bulletContainer),n._masterContainer.addChild(n._hudContainer),n._renderer=null,n._stage=null,n._clockModel=new l.default,n._clockView=null,n._battlefieldView=null,window.devicePixelRatio>=2?n._rendererScale=2:n._rendererScale=1,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),i(e,[{key:"initBatlefield",value:function(t){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"initBatlefield",this).call(this,t),this._masterContainer.x=-this.offsetX,this._masterContainer.y=-this.offsetY;var n={view:this._canvas,antialias:!1,backgroundColor:16777215,resolution:this._rendererScale};this._renderer=new PIXI.autoDetectRenderer(t.width+2*t.margin,t.height+2*t.margin,n),this._stage=new PIXI.Container,this._battlefieldView=this._createBattlefieldView(t),this._clockView=this._createClockView(this._clockModel),this._stage.addChild(this._battlefieldView.view),this._stage.addChild(this._masterContainer),this._stage.addChild(this._clockView.view),this._renderer.render(this._stage)}},{key:"init",value:function(t){this._canvas=t}},{key:"loadAssets",value:function(t){var e=this;if(this._name){var n=PIXI.loader,i=[];for(var r in n.resources)i.push(r);this._getSpritesheetUrls(this._name,this._rendererScale).filter(function(t){return-1==i.indexOf(t)}).forEach(function(t){n.add(t)}),n.load(function(n,i){e.onAssetsLoaded(),t()})}else t()}},{key:"onAssetsLoaded",value:function(){}},{key:"preRender",value:function(){this._battlefieldView.update()}},{key:"renderTank",value:function(t,n){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"renderTank",this).call(this,t,n);var i=this.getTankView(t.id);!i.parent&&i.isAlive&&(this._tankContainer.addChild(i.view),this._hudContainer.addChild(i.hudView))}},{key:"renderBullet",value:function(t,n){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"renderBullet",this).call(this,t,n);var i=this.getBulletView(t.id);!i.parent&&i.isAlive&&this._bulletContainer.addChild(i.view)}},{key:"renderClock",value:function(t,e){this._clockModel.update(t,e),this._clockView.update()}},{key:"postRender",value:function(){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"postRender",this).call(this),this._renderer.render(this._stage)}},{key:"_getSpritesheetUrls",value:function(t,e){return["img/spritesheets/"+t+"/"+(2==e?"retina@2x":"web")+"/jsbattle.json"]}},{key:"_createTankView",value:function(t){return new s.default(t)}},{key:"_createBulletView",value:function(t){return new a.default(t)}},{key:"_createBattlefieldView",value:function(t){return new a.default(t)}},{key:"_createClockView",value:function(t){return new a.default(t)}},{key:"stage",get:function(){return this._stage}},{key:"battlefieldView",get:function(){return this._battlefieldView}},{key:"masterContainer",get:function(){return this._masterContainer}}]),e}();e.default=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(1));var o=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),i(e,[{key:"update",value:function(t){(function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0})(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,t),this.view.scale.x=this.view.scale.y=.7*this.model.power+.3,this.model.exploded&&this.destroy()}}]),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(10));var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._version=2,this._aiList=[],this._rngSeed=(new Date).getTime(),this._teamMode=!1}return i(t,[{key:"addAiDefinition",value:function(t){this._aiList.push(t)}},{key:"setTeamMode",value:function(t){this._teamMode=t}},{key:"getTeamMode",value:function(){return this._teamMode}},{key:"setRngSeed",value:function(t){this._rngSeed=t}},{key:"getVersion",value:function(){return this._version}},{key:"getAiList",value:function(){return this._aiList}},{key:"getRngSeed",value:function(){return this._rngSeed}},{key:"encode",value:function(){var t={version:this._version,rngSeed:this._rngSeed,teamMode:this._teamMode,aiList:[]},e=!0,n=!1,i=void 0;try{for(var r,o=this._aiList[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value;t.aiList.push(a.toJSON())}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}return JSON.stringify(t)}},{key:"decode",value:function(t){var e=void 0;try{e=JSON.parse(t)}catch(t){throw new Error("Cannot parse UBD file! "+t)}if(this._version!=e.version)throw new Error("Version of UBD does not match. Version "+e.version+" is not supported. Please convert to version "+this._version);this._rngSeed=e.rngSeed,this._teamMode=e.teamMode;var n=void 0,i=!0,o=!1,a=void 0;try{for(var s,l=e.aiList[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value;(n=new r.default).fromJSON(u),this._aiList.push(n)}}catch(t){o=!0,a=t}finally{try{!i&&l.return&&l.return()}finally{if(o)throw a}}}},{key:"clone",value:function(){var e=new t;e.setRngSeed(this.getRngSeed()),e.setTeamMode(this.getTeamMode());var n=this.getAiList(),i=!0,r=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var l=a.value;l.clone(),e.addAiDefinition(l)}}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return e}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=!1,o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var e=(new Date).getTime().toString();e=e.substr(e.length-6,6)+""+Math.round(1e7*Math.random()),e=(e=Number(e)).toString(35),this._name="",this._team=e,this._code=null,this._initData=null,this._useSandbox=!0,this._executionLimit=100}return i(t,[{key:"toJSON",value:function(){return{name:this._name,team:this._team,code:this._code,initData:this._initData,useSandbox:this._useSandbox,executionLimit:this.executionLimit}}},{key:"fromJSON",value:function(t){this._name=t.name,this._team=t.team,this._code=t.code,this._initData=t.initData,this._useSandbox=t.useSandbox,this._executionLimit=t.executionLimit}},{key:"clone",value:function(){var e=new t;return e.fromJSON(this.toJSON()),e}},{key:"fromFile",value:function(t,e){if(!t)throw"TankName is required";this._name=t,this._code=null,this._initData=void 0!==e?e:null}},{key:"fromCode",value:function(t,e,n){if(!t)throw"TankName is required";if(!e)throw"Code is required";e=e.replace(/importScripts\w*\([^\)]*\)/g,""),this._name=t,this._code=e,this._initData=void 0!==n?n:null}},{key:"assignToTeam",value:function(t){this._team=t}},{key:"disableSandbox",value:function(){if(!this._code)throw"Sandbox can be disabled for AI created from code only.";r||(console.warn("Disabling sandbox for AI! It could be dangerous."),r=!0),this._useSandbox=!1}},{key:"name",get:function(){return this._name}},{key:"teamName",get:function(){return this._team}},{key:"executionLimit",get:function(){return this._executionLimit},set:function(t){this._executionLimit=t}},{key:"filePath",get:function(){return this._useSandbox?this._code?"tanks/lib/codeWorker.js":"tanks/"+this._name+".tank.js":null}},{key:"code",get:function(){return this._code}},{key:"initData",get:function(){return this._initData}},{key:"useSandbox",get:function(){return this._useSandbox}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._model=e,this._view=null,this._isAlive=!0}return i(t,[{key:"destroy",value:function(){this._isAlive=!1}},{key:"update",value:function(t){}},{key:"isAlive",get:function(){return this._isAlive}},{key:"model",get:function(){return this._model}},{key:"view",get:function(){return this._view}}]),t}();e.default=r},function(t,e,n){"use strict";var i=h(n(13)),r=h(n(6)),o=h(n(33)),a=h(n(40)),s=h(n(45)),l=h(n(51)),u=h(n(10)),c=h(n(9));function h(t){return t&&t.__esModule?t:{default:t}}t.exports={createSimulation:function(t){return t=t||new r.default,new i.default(t)},createAiDefinition:function(){return new u.default},createUBD:function(){return new c.default},createRenderer:function(t){switch(t){case"debug":return new o.default;case"bw":return new a.default;case"brody":return new s.default;case"void":return new l.default;default:throw"Unknown rederer "+t}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=d(n(14)),a=d(n(23)),s=d(n(24)),l=d(n(25)),u=d(n(26)),c=d(n(27)),h=d(n(29)),f=d(n(32)),p=d(n(9)),_=d(n(5));function d(t){return t&&t.__esModule?t:{default:t}}var y=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._aiList=[],this._allTankList=[],this._tankList=[],this._bulletList=[],this._explodedTankList=[],this._explodedBulletList=[],this._battlefield=null,this._simulationTimeout=null,this._renderInterval=null,this._simulationStepDuration=17,this._renderStepDuration=30,this._renderer=e,this._isRunning=!1,this._collisionResolver=new c.default,this._rngSeed=(new Date).getTime()+Math.round(1e6*Math.random()),this._rng=(0,_.default)(this._rngSeed),this._speedMultiplier=1,this._onSimulationStepCallback=[],this._onRenderStepCallback=[],this._onFinishCallback=[],this._onErrorCallback=[],this._onStartCallback=[],this._timeElapsed=0,this._timeLimit=3e4,this._eventStore=new u.default,this._nextTankId=1,this._nextBulletId=1,this._rendererQuality="auto",this._perfMon=new f.default,this._perfMon.setSimulationStepDuration(this._simulationStepDuration/this._speedMultiplier),this._callStackLimit=Number.MAX_VALUE,this._callStackCount=0,this._teamMap=[],this._teamList=[],this._ultimateBattleDescriptor=new p.default}return r(t,[{key:"setRngSeed",value:function(t){this._rngSeed=t,this._ultimateBattleDescriptor.setRngSeed(t),this._rng=(0,_.default)(this._rngSeed)}},{key:"getRngSeed",value:function(){return this._rngSeed}},{key:"getRandom",value:function(){return this._rng()}},{key:"init",value:function(t,e){this._battlefield=new l.default,this._battlefield.setSize(t,e),this._battlefield.randomize(this._rng()),this._renderer.initBatlefield(this._battlefield),this._collisionResolver.updateBattlefield(this._battlefield)}},{key:"start",value:function(){this._isRunning=!0;var t=void 0,e=this;this._renderInterval&&(clearInterval(this._renderInterval),this._renderInterval=null),this._activateAi(function(){for(e._renderInterval=setInterval(function(){e._updateView()},e._renderStepDuration),e._simulationTimeout&&clearTimeout(e._simulationTimeout),e._perfMon.start(),t=0;t<e._onStartCallback.length;t++)e._onStartCallback[t]();e._simulationStep()},function(n){for(console.error(n),t=0;t<e._onErrorCallback.length;t++)e._onErrorCallback[t](n.message?n.message:"Error during simulation")})}},{key:"_simulationStep",value:function(){this._perfMon.onSimulationStep();var t=(new Date).getTime(),e=this,n=void 0;this._updateModel(),this._updateAi(function(){if(e._simulationTimeout&&(clearTimeout(e._simulationTimeout),e._simulationTimeout=null),e._getTeamsLeft()<=1||e._timeElapsed==e._timeLimit)for(e.stop(),e._updateModel(),e._updateView(),n=0;n<e._onFinishCallback.length;n++)e._onFinishCallback[n]();if(e._isRunning){var i=(new Date).getTime()-t,r=e._simulationStepDuration/e._speedMultiplier-i;for(r=Math.round(r),n=0;n<e._onSimulationStepCallback.length;n++)e._onSimulationStepCallback[n]();e._timeElapsed=Math.min(e._timeElapsed+e._simulationStepDuration,e._timeLimit),r>0?(e._callStackCount=0,e._simulationTimeout=setTimeout(e._simulationStep.bind(e),r)):e._callStackCount>=e._callStackLimit?e._simulationTimeout=setTimeout(e._simulationStep.bind(e),1):(e._callStackCount++,e._simulationStep())}},function(t){for(console.error(t),n=0;n<e._onErrorCallback.length;n++)e._onErrorCallback[n](t.message?t.message:"Error during simulation")})}},{key:"addTank",value:function(t){if("object"!=(void 0===t?"undefined":i(t)))throw"AI definition must be an object";if(!this._battlefield)throw"Simulation not initialized";if(!t.teamName)throw"Team name cannot be empty!";var e=this._battlefield.getStartSlot();if(!e)throw"No free space in the battlefield";this._ultimateBattleDescriptor.addAiDefinition(t),this._ultimateBattleDescriptor.setTeamMode(this.hasTeams());var n=this._createTank(t);n.randomize(this.getRandom()),n.moveTo(e.x,e.y),this._tankList.push(n),this._allTankList.push(n),this._allTankList.length>2&&(this._timeLimit+=2e3),this._teamMap[t.teamName]||(this._teamMap[t.teamName]=new a.default(t.teamName),this._teamList.push(this._teamMap[t.teamName])),this._teamMap[t.teamName].addTank(n);var r=this._createAiWrapper(n,t);return this._aiList.push(r),r}},{key:"setSpeed",value:function(t){this._speedMultiplier=Math.max(.01,Number(t)),this._perfMon.setSimulationStepDuration(this._simulationStepDuration/this._speedMultiplier),this._renderer.setSpeed(t)}},{key:"setRendererQuality",value:function(t){isNaN(t)&&"auto"!=t||(isNaN(t)||(t=Math.min(1,Math.max(0,t))),this._rendererQuality=t)}},{key:"stop",value:function(){this._isRunning=!1,this._perfMon.stop(),this._renderer.stop(),this._simulationTimeout&&(clearTimeout(this._simulationTimeout),this._simulationTimeout=null),this._renderInterval&&(clearInterval(this._renderInterval),this._renderInterval=null);var t=void 0,e=void 0;for(e=0;e<this._aiList.length;e++)(t=this._aiList[e])&&t.deactivate();this._aiList=[]}},{key:"onStep",value:function(t){this._onSimulationStepCallback.push(t)}},{key:"onRender",value:function(t){this._onRenderStepCallback.push(t)}},{key:"onStart",value:function(t){this._onStartCallback.push(t)}},{key:"onFinish",value:function(t){this._onFinishCallback.push(t)}},{key:"onError",value:function(t){this._onErrorCallback.push(t)}},{key:"createUltimateBattleDescriptor",value:function(){return this._ultimateBattleDescriptor.clone()}},{key:"hasTeams",value:function(){return this._teamList.length!=this._tankList.length}},{key:"_activateAi",value:function(t,e){this._runInSequence(this._aiList,"activate",this._rng(),t,e)}},{key:"_updateAi",value:function(t,e){this._runInSequence(this._aiList,"simulationStep",null,t,e)}},{key:"_runInSequence",value:function(t,e,n,i,r){if(0==t.length)return i();function o(){for(var t=[],e=arguments[1],n=arguments[0],i=2;i<arguments.length;i++)t.push(arguments[i]);return function(i){e.apply(n,t.concat(i))}}var a=o(null,i),s=o(null,r),l=void 0;l=n?o(t[t.length-1],t[t.length-1][e],n,a,s):o(t[t.length-1],t[t.length-1][e],a,s);for(var u=t.length-2;u>=0;u--)l=n?o(t[u],t[u][e],n,l,s):o(t[u],t[u][e],l,s);l()}},{key:"_updateModel",value:function(){var t=void 0,e=void 0,n=void 0,i=void 0;for(t=0;t<this._tankList.length;t++)(e=this._tankList[t])&&e.simulationStep(this._collisionResolver);var r=0;for(t=0;t<this._tankList.length;t++)(e=this._tankList[t])&&e.energy<=0&&(r++,this._tankList[t]=null,this._explodedTankList.push(e),this._collisionResolver.removeTank(e),this._eventStore.add("tank_"+e.id,{type:"destroy",tank:e}));var o=[];for(t=0;t<this._aiList.length;t++)(i=this._aiList[t])&&(i.tank.energy<=0?(this._aiList[t]=null,i.deactivate()):o.push(i));for(this._aiList=o,t=0;t<this._tankList.length;t++)if((e=this._tankList[t])&&e.isShooting){var a=e.handleShoot();n=this._createBullet(e,a),this._bulletList.push(n),this._eventStore.add("tank_"+e.id,{type:"shoot",tank:e,bullet:n})}for(t=0;t<this._tankList.length;t++)if(e=this._tankList[t])for(var s=0;s<r;s++)e.onSurviveScore();for(t=0;t<this._bulletList.length;t++)(n=this._bulletList[t])&&(n.simulationStep(),this._collisionResolver.hitTestBullet(n)&&(this._bulletList[t]=null,this._explodedBulletList.push(n),this._collisionResolver.removeBullet(n),this._eventStore.add("bullet_"+n.id,{type:"explode",bullet:n})));for(t in this._teamMap)this._teamMap[t].processMessages()}},{key:"_updateView",value:function(){"auto"==this._rendererQuality?this._renderer.quality=this._perfMon.qualityLevel:this._renderer.quality=this._rendererQuality;var t=void 0,e=void 0,n=void 0;for(this._renderer.preRender(),this._renderer.renderClock(this._timeElapsed,this._timeLimit),t=0;t<this._tankList.length;t++)(e=this._tankList[t])&&this._renderer.renderTank(e,this._eventStore.get("tank_"+e.id));for(t=0;t<this._bulletList.length;t++)(n=this._bulletList[t])&&this._renderer.renderBullet(n,this._eventStore.get("bullet_"+n.id));for(;this._explodedTankList.length;)e=this._explodedTankList.pop(),this._renderer.renderTank(e,this._eventStore.get("tank_"+e.id));for(;this._explodedBulletList.length;)n=this._explodedBulletList.pop(),this._renderer.renderBullet(n,this._eventStore.get("bullet_"+n.id));for(this._renderer.renderTankStats(this._allTankList),this._renderer.postRender(),t=0;t<this._onRenderStepCallback.length;t++)this._onRenderStepCallback[t]();this._eventStore.clear()}},{key:"_getTeamsLeft",value:function(){var t=0;for(var e in this._teamMap)this._teamMap[e].isAlive&&t++;return t}},{key:"_createAiWrapper",value:function(t,e){return new h.default(t,e)}},{key:"_createTank",value:function(t){return new o.default(t,this._nextTankId++)}},{key:"_createBullet",value:function(t,e){return new s.default(t,this._nextBulletId++,e)}},{key:"tankList",get:function(){return this._allTankList}},{key:"teamList",get:function(){return this._teamList}},{key:"renderer",get:function(){return this._renderer}},{key:"battlefield",get:function(){return this._battlefield}},{key:"timeElapsed",get:function(){return this._timeElapsed}},{key:"timeLimit",get:function(){return this._timeLimit},set:function(t){this._timeLimit=t}}]),t}();e.default=y},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(t){return t&&t.__esModule?t:{default:t}}(n(5));function a(t){for(;t>180;)t-=360;for(;t<-180;)t+=360;return t}var s=function(){function t(e,n){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"object"!=(void 0===e?"undefined":i(e)))throw"AI definition must be an object";this._id=n,this._name=e.name,this._team=null,this._maxEnergy=100,this._energy=this._maxEnergy,this._x=0,this._y=0,this._lastX=0,this._lastY=0,this._angle=0,this._gunAngle=0,this._radarAngle=0,this._throttle=0,this._actualThrottle=0,this._speed=0,this._turn=0,this._gunTurn=0,this._radarTurn=0,this._wallHit=!1,this._enemyHit=!1,this._allyHit=!1,this._beingRammed=!1,this._radarRange=300,this._radarFocal=6,this._enemySpot=null,this._allySpot=null,this._bulletsSpot=[],this._gunReloadTime=70,this._gunTimer=0,this._shootingPower=0,this._targetingAlarmTimer=0,this._debugData={},this._score=0,this._state=null,this._hasBoost=!1,this._maxBoost=400,this._boost=this._maxBoost,this._wallDistance=null,this._skin="zebra"}return r(t,[{key:"onEnemyHitScore",value:function(t){this._score+=t}},{key:"onEnemyKillScore",value:function(){this._score+=20}},{key:"onSurviveScore",value:function(){this._score+=10}},{key:"setThrottle",value:function(t){this._throttle=Math.min(1,Math.max(-1,t))}},{key:"setTurn",value:function(t){this._turn=Math.min(1,Math.max(-1,t))}},{key:"setGunTurn",value:function(t){this._gunTurn=Math.min(1,Math.max(-1,t))}},{key:"setRadarTurn",value:function(t){this._radarTurn=Math.min(1,Math.max(-1,t))}},{key:"setBoost",value:function(t){this._hasBoost=!!t}},{key:"setDebugData",value:function(t){this._debugData=t}},{key:"onWallHit",value:function(){this._wallHit=!0,this.onDamage(.2)}},{key:"onEnemyHit",value:function(){this._enemyHit=!0,this.onDamage(.2)}},{key:"onAllyHit",value:function(){this._allyHit=!0,this.onDamage(.2)}},{key:"onBeingRam",value:function(t){this._beingRammed=!0,this.onDamage(.1+.1*Math.round(8*t))}},{key:"onEnemySpot",value:function(t){this._enemySpot=t}},{key:"onAllySpot",value:function(t){this._allySpot=t}},{key:"onBulletSpot",value:function(t){this._bulletsSpot.push(t)}},{key:"onWallSpot",value:function(t){this._wallDistance=t}},{key:"onTargetingAlarm",value:function(){this._targetingAlarmTimer=3}},{key:"isAlly",value:function(t){return!!this._team&&(!!t.team&&this._team.name==t.team.name)}},{key:"onDamage",value:function(t){this._energy=Math.max(0,this._energy-t)}},{key:"moveTo",value:function(t,e){this._x=t,this._y=e,this._lastX=t,this._lastY=e}},{key:"handleShoot",value:function(){var t=this._shootingPower;return this._shootingPower=0,t}},{key:"shoot",value:function(t){t=Math.max(.1,Math.min(1,t)),this.isReloading||(this._gunTimer=Math.round(t*this._gunReloadTime),this._shootingPower=t)}},{key:"randomize",value:function(t){void 0===t&&(t=(new Date).getTime()+Math.round(1e6*Math.random()));var e=(0,o.default)(t);this._angle=Math.round(360*e())-180}},{key:"init",value:function(t){t&&t.SKIN&&(this._skin=t.SKIN)}},{key:"simulationStep",value:function(t){if(0!=this._energy){this._hasBoost&&this._boost>0&&this._boost--;var e=this._x,n=this._y,i=this._throttle*(this.hasBoost?4:2),r=this.hasBoost?10:20;this._actualThrottle+=(i-this._actualThrottle)/r;var o=this._actualThrottle,s=this._angle*(Math.PI/180);this._x+=o*Math.cos(s),this._y+=o*Math.sin(s),this._wallHit=!1,this._enemyHit=!1,this._allyHit=!1,!t.checkTank(this)&&(this._x=e,this._y=n,this._actualThrottle=0),this._beingRammed&&(this._enemyHit=!0,this._beingRammed=!1),this._angle+=2*this._turn,this._radarAngle+=6*this._radarTurn,this._gunAngle+=3*this._gunTurn,this._angle=a(this._angle),this._radarAngle=a(this._radarAngle),this._gunAngle=a(this._gunAngle),t.updateTank(this),this._enemySpot=null,this._allySpot=null,this._wallDistance=null,this._targetingAlarmTimer=Math.max(0,this._targetingAlarmTimer-1),t.scanTanks(this),t.scanBullets(this),t.scanWalls(this),this._gunTimer>0&&this._gunTimer--;for(var l=null,u=null,c=[];this._bulletsSpot.length;){var h=this._bulletsSpot.shift();c.push({id:h.id,x:h.x,y:h.y,angle:h.angle,speed:h.speed,damage:h.damage})}this._enemySpot&&(l={id:this._enemySpot.id,x:this._enemySpot.x,y:this._enemySpot.y,angle:this._enemySpot.angle,speed:this._enemySpot.speed,energy:this._enemySpot.energy}),this._allySpot&&(u={id:this._allySpot.id,x:this._allySpot.x,y:this._allySpot.y,angle:this._allySpot.angle,speed:this._allySpot.speed,energy:this._allySpot.energy});var f=this._x-this._lastX,p=this._y-this._lastY;this._speed=Math.sqrt(f*f+p*p),this._lastX=this._x,this._lastY=this._y,this._state={x:this._x,y:this._y,angle:this._angle,energy:this._energy,boost:this._boost,collisions:{wall:this._wallHit,enemy:this._enemyHit,ally:this._allyHit},radar:{angle:this._radarAngle,targetingAlarm:this.targetingAlarm,wallDistance:this._wallDistance,enemy:l,ally:u,bullets:c},gun:{angle:this._gunAngle,reloading:this.isReloading},radio:{inbox:this.team?this.team.getMessages(this.id):[]}}}}},{key:"id",get:function(){return this._id}},{key:"skin",get:function(){return this._skin}},{key:"state",get:function(){return this._state}},{key:"energy",get:function(){return this._energy}},{key:"score",get:function(){return this._score}},{key:"maxEnergy",get:function(){return this._maxEnergy}},{key:"radarRange",get:function(){return this._radarRange}},{key:"radarFocal",get:function(){return this._radarFocal}},{key:"name",get:function(){return this._name}},{key:"fullName",get:function(){return this._name+" #"+this._id}},{key:"team",get:function(){return this._team}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"speed",get:function(){return this._speed}},{key:"gunLength",get:function(){return 25}},{key:"angle",get:function(){return this._angle}},{key:"throttle",get:function(){return this._throttle}},{key:"hasBoost",get:function(){return this._hasBoost&&this._boost>0}},{key:"boost",get:function(){return this._boost}},{key:"maxBoost",get:function(){return this._maxBoost}},{key:"gunAngle",get:function(){return this._gunAngle}},{key:"radarAngle",get:function(){return this._radarAngle}},{key:"enemySpot",get:function(){return this._enemySpot}},{key:"allySpot",get:function(){return this._allySpot}},{key:"targetingAlarm",get:function(){return this._targetingAlarmTimer>0}},{key:"debugData",get:function(){return this._debugData}},{key:"isShooting",get:function(){return this._shootingPower>0}},{key:"shootingPower",get:function(){return this._shootingPower}},{key:"isReloading",get:function(){return this._gunTimer>0}}]),t}();e.default=s},function(t,e,n){"use strict";(function(t){var i,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,o,a){function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function l(t,e){var n=new function(t){var e=this,n=function(){var t=4022871197;return function(e){e=e.toString();for(var n=0;n<e.length;n++){var i=.02519603282416938*(t+=e.charCodeAt(n));i-=t=i>>>0,t=(i*=t)>>>0,t+=4294967296*(i-=t)}return 2.3283064365386963e-10*(t>>>0)}}();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}(t),i=e&&e.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+1.1102230246251565e-16*(2097152*o()|0)},o.quick=o,i&&("object"==(void 0===i?"undefined":r(i))&&s(i,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=l:n(0)&&n(3)?void 0===(i=function(){return l}.call(e,n,e,o))||(o.exports=i):this.alea=l}(0,"object"==r(t)&&t,n(0))}).call(e,n(2)(t))},function(t,e,n){"use strict";(function(t){var i,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,o,a){function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function l(t,e){var n=new function(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var i=0;i<n.length+64;i++)e.x^=0|n.charCodeAt(i),e.next()}(t),i=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,i&&("object"==(void 0===i?"undefined":r(i))&&s(i,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=l:n(0)&&n(3)?void 0===(i=function(){return l}.call(e,n,e,o))||(o.exports=i):this.xor128=l}(0,"object"==r(t)&&t,n(0))}).call(e,n(2)(t))},function(t,e,n){"use strict";(function(t){var i,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,o,a){function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function l(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var i=0;i<n.length+64;i++)e.x^=0|n.charCodeAt(i),i==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}(t),i=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,i&&("object"==(void 0===i?"undefined":r(i))&&s(i,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=l:n(0)&&n(3)?void 0===(i=function(){return l}.call(e,n,e,o))||(o.exports=i):this.xorwow=l}(0,"object"==r(t)&&t,n(0))}).call(e,n(2)(t))},function(t,e,n){"use strict";(function(t){var i;!function(t,r,o){function a(t,e){return e.x=t.x.slice(),e.i=t.i,e}function s(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,i=e.x,r=e.i;return t=i[r],n=(t^=t>>>7)^t<<24,n^=(t=i[r+1&7])^t>>>10,n^=(t=i[r+3&7])^t>>>3,n^=(t=i[r+4&7])^t<<7,t=i[r+7&7],n^=(t^=t<<13)^t<<9,i[r]=n,e.i=r+1&7,n},function(t,e){var n,i=[];if(e===(0|e))i[0]=e;else for(e=""+e,n=0;n<e.length;++n)i[7&n]=i[7&n]<<15^e.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(8==n?i[7]=-1:i[n],t.x=i,t.i=0,n=256;n>0;--n)t.next()}(e,t)}(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&(i.x&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=s:n(0)&&n(3)?void 0===(i=function(){return s}.call(e,n,e,r))||(r.exports=i):this.xorshift7=s}(0,"object"==("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)&&t,n(0))}).call(e,n(2)(t))},function(t,e,n){"use strict";(function(t){var i;!function(t,r,o){function a(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function s(t,e){null==t&&(t=+new Date);var n=new function(t){var e=this;e.next=function(){var t,n,i=e.w,r=e.X,o=e.i;return e.w=i=i+1640531527|0,n=r[o+34&127],t=r[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=r[o]=n^t,e.i=o,n+(i^i>>>16)|0},function(t,e){var n,i,r,o,a,s=[],l=128;for(e===(0|e)?(i=e,e=null):(e+="\0",i=0,l=Math.max(l,e.length)),r=0,o=-32;o<l;++o)e&&(i^=e.charCodeAt((o+32)%e.length)),0===o&&(a=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,o>=0&&(a=a+1640531527|0,r=0==(n=s[127&o]^=i+a)?r+1:0);for(r>=128&&(s[127&(e&&e.length||0)]=-1),r=127,o=512;o>0;--o)i=s[r+34&127],n=s[r=r+1&127],i^=i<<13,n^=n<<17,i^=i>>>15,n^=n>>>12,s[r]=i^n;t.w=a,t.X=s,t.i=r}(e,t)}(t),i=e&&e.state,r=function(){return(n.next()>>>0)/4294967296};return r.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},r.int32=n.next,r.quick=r,i&&(i.X&&a(i,n),r.state=function(){return a(n,{})}),r}r&&r.exports?r.exports=s:n(0)&&n(3)?void 0===(i=function(){return s}.call(e,n,e,r))||(r.exports=i):this.xor4096=s}(0,"object"==("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)&&t,n(0))}).call(e,n(2)(t))},function(t,e,n){"use strict";(function(t){var i,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,o,a){function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function l(t,e){var n=new function(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,i=e.d,r=e.a;return t=t<<25^t>>>7^n,n=n-i|0,i=i<<24^i>>>8^r,r=r-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-i|0,e.d=i<<16^n>>>16^r,e.a=r-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var i=0;i<n.length+20;i++)e.b^=0|n.charCodeAt(i),e.next()}(t),i=e&&e.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},o.int32=n.next,o.quick=o,i&&("object"==(void 0===i?"undefined":r(i))&&s(i,n),o.state=function(){return s(n,{})}),o}o&&o.exports?o.exports=l:n(0)&&n(3)?void 0===(i=function(){return l}.call(e,n,e,o))||(o.exports=i):this.tychei=l}(0,"object"==r(t)&&t,n(0))}).call(e,n(2)(t))},function(t,e,n){"use strict";(function(t){var i,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(o,a){var s,l=(0,eval)("this"),u=256,c=6,h="random",f=a.pow(u,c),p=a.pow(2,52),_=2*p,d=u-1;function y(t,e,n){var i=[],y=m(function t(e,n){var i,o=[],a=void 0===e?"undefined":r(e);if(n&&"object"==a)for(i in e)try{o.push(t(e[i],n-1))}catch(t){}return o.length?o:"string"==a?e:e+"\0"}((e=1==e?{entropy:!0}:e||{}).entropy?[t,b(o)]:null==t?function(){try{var t;return s&&(t=s.randomBytes)?t=t(u):(t=new Uint8Array(u),(l.crypto||l.msCrypto).getRandomValues(t)),b(t)}catch(t){var e=l.navigator,n=e&&e.plugins;return[+new Date,l,n,l.screen,b(o)]}}():t,3),i),g=new function(t){var e,n=t.length,i=this,r=0,o=i.i=i.j=0,a=i.S=[];n||(t=[n++]);for(;r<u;)a[r]=r++;for(r=0;r<u;r++)a[r]=a[o=d&o+t[r%n]+(e=a[r])],a[o]=e;(i.g=function(t){for(var e,n=0,r=i.i,o=i.j,a=i.S;t--;)e=a[r=d&r+1],n=n*u+a[d&(a[r]=a[o=d&o+e])+(a[o]=e)];return i.i=r,i.j=o,n})(u)}(i),k=function(){for(var t=g.g(c),e=f,n=0;t<p;)t=(t+n)*u,e*=u,n=g.g(1);for(;t>=_;)t/=2,e/=2,n>>>=1;return(t+n)/e};return k.int32=function(){return 0|g.g(4)},k.quick=function(){return g.g(4)/4294967296},k.double=k,m(b(g.S),o),(e.pass||n||function(t,e,n,i){return i&&(i.S&&v(i,g),t.state=function(){return v(g,{})}),n?(a[h]=t,e):t})(k,y,"global"in e?e.global:this==a,e.state)}function v(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function m(t,e){for(var n,i=t+"",r=0;r<i.length;)e[d&r]=d&(n^=19*e[d&r])+i.charCodeAt(r++);return b(e)}function b(t){return String.fromCharCode.apply(0,t)}if(a["seed"+h]=y,m(a.random(),o),"object"==r(t)&&t.exports){t.exports=y;try{s=n(22)}catch(t){}}else void 0===(i=function(){return y}.call(e,n,e,t))||(t.exports=i)}([],Math)}).call(e,n(2)(t))},function(t,e){},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=e,this._members=[],this._inboxMap=[],this._outboxMap=[]}return i(t,[{key:"addTank",value:function(t){if(t.team)throw"Tank "+t.fullName+" is already assigned to team "+t.team.name;for(var e in this._members)if(this._members[e].id==t.id)return;this._members.push(t),t._team=this,this._inboxMap[t.id]=[],this._outboxMap[t.id]=[]}},{key:"getMessages",value:function(t){return this._outboxMap[t]}},{key:"sendMessages",value:function(t,e){for(var n in this._inboxMap)n!=t&&(this._inboxMap[n]=this._inboxMap[n].concat(e))}},{key:"processMessages",value:function(){var t=void 0;for(t in this._inboxMap)this._outboxMap[t]=this._inboxMap[t],this._inboxMap[t]=[]}},{key:"size",get:function(){return this._members.length}},{key:"name",get:function(){return this._name}},{key:"aliveCount",get:function(){for(var t=0,e=0;e<this._members.length;e++)this._members[e].energy>0&&t++;return t}},{key:"score",get:function(){for(var t=0,e=0;e<this._members.length;e++)t+=this._members[e].score;return t}},{key:"energy",get:function(){for(var t=0,e=0;e<this._members.length;e++)t+=this._members[e].energy;return t}},{key:"maxEnergy",get:function(){for(var t=0,e=0;e<this._members.length;e++)t+=this._members[e].maxEnergy;return t}},{key:"isAlive",get:function(){return this.aliveCount>0}},{key:"members",get:function(){return this._members}}]),t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(e,n,i){for(!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._id=n,this._owner=e,this._angle=e.angle+e.gunAngle;this._angle>180;)this._angle-=360;for(;this._angle<-180;)this._angle+=360;this._x=e.x+e.gunLength*Math.cos(this._angle*(Math.PI/180)),this._y=e.y+e.gunLength*Math.sin(this._angle*(Math.PI/180)),this._speed=4,this._power=i,this._damage=.01*Math.round(1e3*i+300*i*i),this._exploded=!1}return i(t,[{key:"onWallHit",value:function(){this._exploded=!0}},{key:"onEnemyHit",value:function(t){this._exploded=!0,t.onDamage(this._damage)}},{key:"simulationStep",value:function(){this._x+=this._speed*Math.cos(this._angle*(Math.PI/180)),this._y+=this._speed*Math.sin(this._angle*(Math.PI/180))}},{key:"id",get:function(){return this._id}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"angle",get:function(){return this._angle}},{key:"speed",get:function(){return this._speed}},{key:"damage",get:function(){return this._damage}},{key:"power",get:function(){return this._power}},{key:"owner",get:function(){return this._owner}},{key:"exploded",get:function(){return this._exploded}}]),t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(5));var o=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._width=null,this._height=null,this._startSlotList=[],this._offsetX=0,this._offsetY=0}return i(t,[{key:"setSize",value:function(t,e){this._width=t-2*this.margin,this._height=e-2*this.margin}},{key:"randomize",value:function(t){void 0===t&&(t=(new Date).getTime()+Math.round(1e6*Math.random()));var e=(0,r.default)(t);this._offsetX=Math.round(1e4*e()-5e3),this._offsetY=Math.round(1e4*e()-5e3),this._startSlotList=[];for(var n=this.minX+90;n<this.maxX-90;n+=90)for(var i=this.minY+90;i<this.maxY-90;i+=90)this._startSlotList.push({x:n,y:i});for(var o=this._startSlotList.length,a=void 0,s=void 0;0!==o;)s=Math.floor(e()*o),o-=1,a=this._startSlotList[o],this._startSlotList[o]=this._startSlotList[s],this._startSlotList[s]=a}},{key:"getStartSlot",value:function(){return this._startSlotList.length?this._startSlotList.pop():null}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"margin",get:function(){return 25}},{key:"minX",get:function(){return this._offsetX+this.margin}},{key:"minY",get:function(){return this._offsetY+this.margin}},{key:"maxX",get:function(){return this._offsetX+this._width+this.margin}},{key:"maxY",get:function(){return this._offsetY+this._height+this.margin}},{key:"offsetX",get:function(){return this._offsetX}},{key:"offsetY",get:function(){return this._offsetY}}]),t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._data=[]}return i(t,[{key:"add",value:function(t,e){this._data[t]||(this._data[t]=[]),this._data[t].push(e)}},{key:"get",value:function(t){return this._data[t]||(this._data[t]=[]),this._data[t]}},{key:"clear",value:function(t){this._data=[]}}]),t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(28));var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._wallList=[],this._tankMap=[],this._bulletMap=[],this._radarBeamMap=[],this._battlefield=null}return i(t,[{key:"updateBattlefield",value:function(t){this._battlefield={minX:t.minX,minY:t.minY,maxX:t.maxX,maxY:t.maxY};var e=void 0;e=new r.default.Box(new r.default.Vector(t.minX-10,t.minY),10,t.height).toPolygon(),this._wallList.push(e),e=new r.default.Box(new r.default.Vector(t.minX,t.minY-10),t.width,10).toPolygon(),this._wallList.push(e),e=new r.default.Box(new r.default.Vector(t.maxX,t.minY),10,t.height).toPolygon(),this._wallList.push(e),e=new r.default.Box(new r.default.Vector(t.minX,t.maxY),t.width,10).toPolygon(),this._wallList.push(e)}},{key:"updateTank",value:function(t){var e=this._getTankShape(t);e.pos.x=t.x,e.pos.y=t.y}},{key:"removeBullet",value:function(t){this._bulletMap[t.id]=null}},{key:"removeTank",value:function(t){this._tankMap[t.id]=null,this._radarBeamMap[t.id]=null}},{key:"hitTestBullet",value:function(t){var e=this._getBulletShape(t),n=t.owner.energy?this._getTankShape(t.owner):null;e.pos.x=t.x,e.pos.y=t.y;var i=void 0,o=void 0;for(i in this._wallList)if(o=this._wallList[i],r.default.testCirclePolygon(e,o))return t.onWallHit(),!0;var a=void 0;for(i in this._tankMap)if((a=this._tankMap[i])&&a!=n&&r.default.testCircleCircle(e,a)){var s=a.tank.energy;return t.onEnemyHit(a.tank),t.owner.isAlly(a.tank)||t.owner.onEnemyHitScore(s-a.tank.energy),0==a.tank.energy&&t.owner.onEnemyKillScore(),!0}return!1}},{key:"checkTank",value:function(t){var e=this._getTankShape(t);e.pos.x=t.x,e.pos.y=t.y;var n=void 0,i=void 0,o=void 0;for(n in this._wallList)if(o=this._wallList[n],i=r.default.testCirclePolygon(e,o))return t.onWallHit(),!1;var a=void 0;for(n in this._tankMap)if((a=this._tankMap[n])&&a!=e){i=r.default.testCircleCircle(e,a);var s=t.isAlly(a.tank);if(i){if(s)return t.onAllyHit(),!1;var l=a.tank.energy;return t.onEnemyHit(),a.tank.onBeingRam(t.speed),t.onEnemyHitScore(l-a.tank.energy),!1}}return!0}},{key:"scanTanks",value:function(t){var e=this._getRadarBeamShape(t),n=this._getTankShape(t);e.setAngle((t.angle+t.radarAngle)*Math.PI/180),e.pos.x=t.x,e.pos.y=t.y;var i=void 0,o=void 0,a=[];for(i in this._tankMap)(o=this._tankMap[i])&&o!=n&&r.default.testPolygonCircle(e,o)&&a.push(o.tank);if(0==a.length)return!1;var s=null,l=t.radarRange,u=null,c=t.radarRange,h=void 0,f=void 0,p=void 0,_=void 0;for(i in a)f=a[i].x-t.x,p=a[i].y-t.y,h=Math.sqrt(f*f+p*p),(_=a[i].isAlly(t))||s&&!(h<l)?_&&(!u||h<c)&&(u=a[i],c=h):(s=a[i],l=h);return u&&t.onAllySpot(u),s&&(t.onEnemySpot(s),s.onTargetingAlarm()),!0}},{key:"scanBullets",value:function(t){var e=this._getRadarBeamShape(t);e.setAngle((t.angle+t.radarAngle)*Math.PI/180),e.pos.x=t.x,e.pos.y=t.y;var n=void 0,i=void 0,o=!1;for(n in this._bulletMap)(i=this._bulletMap[n])&&i.bullet.owner!=t&&r.default.testCirclePolygon(i,e)&&(t.onBulletSpot(i.bullet),o=!0);return o}},{key:"scanWalls",value:function(t){var e=this._getWallDistance(t);return e<t.radarRange&&(t.onWallSpot(e),!0)}},{key:"_getWallDistance",value:function(t){for(var e=t.angle+t.radarAngle;e>180;)e-=360;for(;e<-180;)e+=360;var n=t.y-this._battlefield.minY,i=this._battlefield.maxY-t.y,r=t.x-this._battlefield.minX,o=this._battlefield.maxX-t.x;if(-180==e||180==e)return r;if(0==e)return o;if(-90==e)return n;if(90==e)return i;var a=void 0,s=void 0;return e>-180&&e<-90?(a=r/Math.cos((e+180)*(Math.PI/180)),s=n/Math.sin((e+180)*(Math.PI/180))):e>-90&&e<0?(a=o/Math.cos(-e*(Math.PI/180)),s=n/Math.sin(-e*(Math.PI/180))):e>0&&e<90?(a=o/Math.cos(e*(Math.PI/180)),s=i/Math.sin(e*(Math.PI/180))):(a=r/Math.cos((180-e)*(Math.PI/180)),s=i/Math.sin((180-e)*(Math.PI/180))),Math.min(a,s)}},{key:"_getTankShape",value:function(t){if(!this._tankMap[t.id]){if(0==t.energy)throw"Cannot create shape for destroyed tank";var e=new r.default.Circle(new r.default.Vector(t.x,t.y),18);this._tankMap[t.id]=e,e.tank=t}return this._tankMap[t.id]}},{key:"_getBulletShape",value:function(t){if(!this._bulletMap[t.id]){if(t.exploded)throw"Cannot create shape for exploded bullet";var e=new r.default.Circle(new r.default.Vector(t.x,t.y),3);this._bulletMap[t.id]=e,e.bullet=t}return this._bulletMap[t.id]}},{key:"_getRadarBeamShape",value:function(t){if(!this._radarBeamMap[t.id]){if(0==t.energy)throw"Cannot create radar beam shape for destroyed tank";var e=t.radarRange*Math.tan(t.radarFocal*(Math.PI/180))/2,n=new r.default.Polygon(new r.default.Vector(t.x,t.y),[new r.default.Vector(0,3),new r.default.Vector(0,-3),new r.default.Vector(t.radarRange,-e),new r.default.Vector(t.radarRange,e)]);this._radarBeamMap[t.id]=n,n.tank=t}return this._radarBeamMap[t.id]}}]),t}();e.default=o},function(t,e,n){"use strict";var i,r;"function"==typeof Symbol&&Symbol.iterator;
/** @preserve SAT.js - Version 0.7.1 - Copyright 2012 - 2018 - Jim Riecken <jimr@jimr.ca> - released under the MIT License. https://github.com/jriecken/sat-js */
!function(o,a){void 0===(r="function"==typeof(i=a)?i.call(e,n,e,t):i)||(t.exports=r)}(0,function(){var t={};function e(t,e){this.x=t||0,this.y=e||0}function n(t,n){this.pos=t||new e,this.r=n||0}function i(t,n){this.pos=t||new e,this.angle=0,this.offset=new e,this.setPoints(n||[])}function r(t,n,i){this.pos=t||new e,this.w=n||0,this.h=i||0}function o(){this.a=null,this.b=null,this.overlapN=new e,this.overlapV=new e,this.clear()}t.Vector=e,t.V=e,e.prototype.copy=e.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},e.prototype.clone=e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.perp=e.prototype.perp=function(){var t=this.x;return this.x=this.y,this.y=-t,this},e.prototype.rotate=e.prototype.rotate=function(t){var e=this.x,n=this.y;return this.x=e*Math.cos(t)-n*Math.sin(t),this.y=e*Math.sin(t)+n*Math.cos(t),this},e.prototype.reverse=e.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},e.prototype.normalize=e.prototype.normalize=function(){var t=this.len();return t>0&&(this.x=this.x/t,this.y=this.y/t),this},e.prototype.add=e.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},e.prototype.sub=e.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},e.prototype.scale=e.prototype.scale=function(t,e){return this.x*=t,this.y*=void 0!==e?e:t,this},e.prototype.project=e.prototype.project=function(t){var e=this.dot(t)/t.len2();return this.x=e*t.x,this.y=e*t.y,this},e.prototype.projectN=e.prototype.projectN=function(t){var e=this.dot(t);return this.x=e*t.x,this.y=e*t.y,this},e.prototype.reflect=e.prototype.reflect=function(t){var e=this.x,n=this.y;return this.project(t).scale(2),this.x-=e,this.y-=n,this},e.prototype.reflectN=e.prototype.reflectN=function(t){var e=this.x,n=this.y;return this.projectN(t).scale(2),this.x-=e,this.y-=n,this},e.prototype.dot=e.prototype.dot=function(t){return this.x*t.x+this.y*t.y},e.prototype.len2=e.prototype.len2=function(){return this.dot(this)},e.prototype.len=e.prototype.len=function(){return Math.sqrt(this.len2())},t.Circle=n,n.prototype.getAABB=n.prototype.getAABB=function(){var t=this.r;return new r(this.pos.clone().sub(new e(t,t)),2*t,2*t).toPolygon()},t.Polygon=i,i.prototype.setPoints=i.prototype.setPoints=function(t){if(!this.points||this.points.length!==t.length){var n,i=this.calcPoints=[],r=this.edges=[],o=this.normals=[];for(n=0;n<t.length;n++)i.push(new e),r.push(new e),o.push(new e)}return this.points=t,this._recalc(),this},i.prototype.setAngle=i.prototype.setAngle=function(t){return this.angle=t,this._recalc(),this},i.prototype.setOffset=i.prototype.setOffset=function(t){return this.offset=t,this._recalc(),this},i.prototype.rotate=i.prototype.rotate=function(t){for(var e=this.points,n=e.length,i=0;i<n;i++)e[i].rotate(t);return this._recalc(),this},i.prototype.translate=i.prototype.translate=function(t,e){for(var n=this.points,i=n.length,r=0;r<i;r++)n[r].x+=t,n[r].y+=e;return this._recalc(),this},i.prototype._recalc=function(){var t,e=this.calcPoints,n=this.edges,i=this.normals,r=this.points,o=this.offset,a=this.angle,s=r.length;for(t=0;t<s;t++){var l=e[t].copy(r[t]);l.x+=o.x,l.y+=o.y,0!==a&&l.rotate(a)}for(t=0;t<s;t++){var u=e[t],c=t<s-1?e[t+1]:e[0],h=n[t].copy(c).sub(u);i[t].copy(h).perp().normalize()}return this},i.prototype.getAABB=i.prototype.getAABB=function(){for(var t=this.calcPoints,n=t.length,i=t[0].x,o=t[0].y,a=t[0].x,s=t[0].y,l=1;l<n;l++){var u=t[l];u.x<i?i=u.x:u.x>a&&(a=u.x),u.y<o?o=u.y:u.y>s&&(s=u.y)}return new r(this.pos.clone().add(new e(i,o)),a-i,s-o).toPolygon()},i.prototype.getCentroid=i.prototype.getCentroid=function(){for(var t=this.calcPoints,n=t.length,i=0,r=0,o=0,a=0;a<n;a++){var s=t[a],l=a===n-1?t[0]:t[a+1],u=s.x*l.y-l.x*s.y;i+=(s.x+l.x)*u,r+=(s.y+l.y)*u,o+=u}return new e(i/=o*=3,r/=o)},t.Box=r,r.prototype.toPolygon=r.prototype.toPolygon=function(){var t=this.pos,n=this.w,r=this.h;return new i(new e(t.x,t.y),[new e,new e(n,0),new e(n,r),new e(0,r)])},t.Response=o,o.prototype.clear=o.prototype.clear=function(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this};for(var a=[],s=0;s<10;s++)a.push(new e);var l=[];for(s=0;s<5;s++)l.push([]);var u=new o,c=new r(new e,1e-6,1e-6).toPolygon();function h(t,e,n){for(var i=Number.MAX_VALUE,r=-Number.MAX_VALUE,o=t.length,a=0;a<o;a++){var s=t[a].dot(e);s<i&&(i=s),s>r&&(r=s)}n[0]=i,n[1]=r}function f(t,e,n,i,r,o){var s=l.pop(),u=l.pop(),c=a.pop().copy(e).sub(t),f=c.dot(r);if(h(n,r,s),h(i,r,u),u[0]+=f,u[1]+=f,s[0]>u[1]||u[0]>s[1])return a.push(c),l.push(s),l.push(u),!0;if(o){var p,_,d=0;if(s[0]<u[0])if(o.aInB=!1,s[1]<u[1])d=s[1]-u[0],o.bInA=!1;else d=(p=s[1]-u[0])<(_=u[1]-s[0])?p:-_;else if(o.bInA=!1,s[1]>u[1])d=s[0]-u[1],o.aInB=!1;else d=(p=s[1]-u[0])<(_=u[1]-s[0])?p:-_;var y=Math.abs(d);y<o.overlap&&(o.overlap=y,o.overlapN.copy(r),d<0&&o.overlapN.reverse())}return a.push(c),l.push(s),l.push(u),!1}function p(t,e){var n=t.len2(),i=e.dot(t);return i<0?_:i>n?y:d}t.isSeparatingAxis=f;var _=-1,d=0,y=1;function v(t,e,n){for(var i=a.pop().copy(e.pos).sub(t.pos),r=e.r,o=r*r,s=t.calcPoints,l=s.length,u=a.pop(),c=a.pop(),h=0;h<l;h++){var f=h===l-1?0:h+1,d=0===h?l-1:h-1,v=0,m=null;u.copy(t.edges[h]),c.copy(i).sub(s[h]),n&&c.len2()>o&&(n.aInB=!1);var b=p(u,c);if(b===_){u.copy(t.edges[d]);var g=a.pop().copy(i).sub(s[d]);if((b=p(u,g))===y){if((w=c.len())>r)return a.push(i),a.push(u),a.push(c),a.push(g),!1;n&&(n.bInA=!1,m=c.normalize(),v=r-w)}a.push(g)}else if(b===y){if(u.copy(t.edges[f]),c.copy(i).sub(s[f]),(b=p(u,c))===_){if((w=c.len())>r)return a.push(i),a.push(u),a.push(c),!1;n&&(n.bInA=!1,m=c.normalize(),v=r-w)}}else{var k=u.perp().normalize(),w=c.dot(k),x=Math.abs(w);if(w>0&&x>r)return a.push(i),a.push(k),a.push(c),!1;n&&(m=k,v=r-w,(w>=0||v<2*r)&&(n.bInA=!1))}m&&n&&Math.abs(v)<Math.abs(n.overlap)&&(n.overlap=v,n.overlapN.copy(m))}return n&&(n.a=t,n.b=e,n.overlapV.copy(n.overlapN).scale(n.overlap)),a.push(i),a.push(u),a.push(c),!0}function m(t,e,n){for(var i=t.calcPoints,r=i.length,o=e.calcPoints,a=o.length,s=0;s<r;s++)if(f(t.pos,e.pos,i,o,t.normals[s],n))return!1;for(s=0;s<a;s++)if(f(t.pos,e.pos,i,o,e.normals[s],n))return!1;return n&&(n.a=t,n.b=e,n.overlapV.copy(n.overlapN).scale(n.overlap)),!0}return t.pointInCircle=function(t,e){var n=a.pop().copy(t).sub(e.pos),i=e.r*e.r,r=n.len2();return a.push(n),r<=i},t.pointInPolygon=function(t,e){c.pos.copy(t),u.clear();var n=m(c,e,u);return n&&(n=u.aInB),n},t.testCircleCircle=function(t,e,n){var i=a.pop().copy(e.pos).sub(t.pos),r=t.r+e.r,o=r*r,s=i.len2();if(s>o)return a.push(i),!1;if(n){var l=Math.sqrt(s);n.a=t,n.b=e,n.overlap=r-l,n.overlapN.copy(i.normalize()),n.overlapV.copy(i).scale(n.overlap),n.aInB=t.r<=e.r&&l<=e.r-t.r,n.bInA=e.r<=t.r&&l<=t.r-e.r}return a.push(i),!0},t.testPolygonCircle=v,t.testCirclePolygon=function(t,e,n){var i=v(e,t,n);if(i&&n){var r=n.a,o=n.aInB;n.overlapN.reverse(),n.overlapV.reverse(),n.a=n.b,n.b=r,n.aInB=n.bInA,n.bInA=o}return i},t.testPolygonPolygon=m,t})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(t){return t&&t.__esModule?t:{default:t}}(n(30));var a=function(){function t(e,n){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!e)throw"Tank is required";if(!n)throw"AiDefinition is required";this._tank=e,this._aiWorker=null,this._aiProcessingStart=0,this._aiProcessingCheckInterval=null,this._aiProcessingResolveCallback=null,this._aiProcessingRejectCallback=null,this._slowAiChances=10,this._onActivationCallback=[],this._onDectivationCallback=[],this._aiProcessingTimeLimit=3e3,this._aiDefinition=n,this._isReady=!1,this._controlData={THROTTLE:0,BOOST:0,TURN:0,RADAR_TURN:0,GUN_TURN:0,SHOOT:0,OUTBOX:[],DEBUG:{}}}return r(t,[{key:"setProcessingLimit",value:function(t){this._aiProcessingTimeLimit=t}},{key:"onActivation",value:function(t){this._onActivationCallback.push(t)}},{key:"onDectivation",value:function(t){this._onDeactivationCallback.push(t)}},{key:"_formatError",value:function(t){if(!t.message)return"unknown";var e=t.message;return t.lineno&&(e="Line #"+t.lineno+": "+e),e}},{key:"activate",value:function(t,e,n){if("number"!=typeof t)throw"seed must be a number, '"+(void 0===t?"undefined":i(t))+"' given";if("function"!=typeof e)throw"resolve callback must be a function, '"+(void 0===e?"undefined":i(e))+"' given";if("function"!=typeof n)throw"reject callback must be a function, '"+(void 0===n?"undefined":i(n))+"' given";var r=this;r._aiWorker=r._createWorker(this._aiDefinition),r._aiWorker.onerror=function(t){console.error(t),r._aiProcessingRejectCallback&&(r._aiProcessingRejectCallback({message:"Web Worker of '"+r._tank.fullName+"' returned an error: "+r._formatError(t),performanceIssues:!1,tankName:r._tank.name,tankId:r._tank.id}),r._aiProcessingResolveCallback=null,r._aiProcessingRejectCallback=null)},r._aiProcessingCheckInterval&&(clearInterval(r._aiProcessingCheckInterval),r._aiProcessingCheckInterval=null),r._aiProcessingCheckInterval=setInterval(function(){r._aiProcessingRejectCallback&&((new Date).getTime()-r._aiProcessingStart>r._aiProcessingTimeLimit&&(clearInterval(r._aiProcessingCheckInterval),r._aiProcessingCheckInterval=null,r._aiProcessingRejectCallback({message:"Simulation cannot be continued because "+r._tank.name+" #"+r._tank.id+" does not respond",performanceIssues:!0,tankName:r._tank.name,tankId:r._tank.id})))},Math.max(r._aiDefinition.executionLimit,Math.round(r._aiProcessingTimeLimit/2))),r._aiWorker.onmessage=function(t){var e=t.data;if(r._aiProcessingResolveCallback){if("init"==e.type){r._configureTank(e.settings?e.settings:{}),r._isReady=!0;for(var n=0;n<r._onActivationCallback.length;n++)r._onActivationCallback[n].bind(r)()}else r._controlTank(e);var i=void 0,o=(new Date).getTime()-r._aiProcessingStart;if(o>r._aiDefinition.executionLimit&&"init"!=e.type&&(r._slowAiChances--,console.warn("Execution of AI for tank "+r._tank.name+" #"+r._tank.id+" takes too long ("+o+"ms). If problem repeats, AI will be terminated."),r._slowAiChances<=0))return i=r._aiProcessingRejectCallback,r._aiProcessingResolveCallback=null,r._aiProcessingRejectCallback=null,void i({message:"Simulation cannot be continued because "+r._tank.name+" #"+r._tank.id+" has performance issues",performanceIssues:!0,tankName:r._tank.name,tankId:r._tank.id});i=r._aiProcessingResolveCallback,r._aiProcessingResolveCallback=null,r._aiProcessingRejectCallback=null,i()}};var o=null;o=r._tank.team&&r._tank.team.size>1?{name:r._tank.team.name,mates:r._tank.team.members.map(function(t){return t.id})}:{name:r._tank.fullName,mates:[r._tank.id]};var a={id:r._tank.id,team:o};r._aiDefinition.initData&&(a.initData=r._aiDefinition.initData),r._aiProcessingStart=(new Date).getTime(),r._aiProcessingResolveCallback=e,r._aiProcessingRejectCallback=n,r._aiWorker.postMessage({command:"init",seed:t+":"+r._tank.id,settings:{SKIN:"zebra"},info:a,code:r._aiDefinition.code})}},{key:"deactivate",value:function(){this._aiWorker&&(this._aiWorker.terminate(),this._aiWorker=null),this._aiProcessingCheckInterval&&(clearInterval(this._aiProcessingCheckInterval),this._aiProcessingCheckInterval=null);for(var t=0;t<this._onDectivationCallback.length;t++)this._onDectivationCallback[t].bind(this)()}},{key:"simulationStep",value:function(t,e){if("function"!=typeof t)throw"resolve callback must be a function, '"+(void 0===t?"undefined":i(t))+"' given";if("function"!=typeof e)throw"reject callback must be a function, '"+(void 0===e?"undefined":i(e))+"' given";if(!this._isReady)throw"AI of "+this._tank.fullName+" not initliazed";if(this._aiWorker&&0==this._tank.energy)return this._aiWorker.terminate(),this._aiWorker=null,void t();this._aiProcessingStart=(new Date).getTime(),this._aiProcessingResolveCallback=t,this._aiProcessingRejectCallback=e,this._aiWorker.postMessage({command:"update",state:this._tank.state,control:this._controlData})}},{key:"_configureTank",value:function(t){var e={};-1!=["zebra","forest","black","tiger","desert","lava","ocean"].indexOf(t.SKIN)&&(e.SKIN=t.SKIN),this._tank.init(e)}},{key:"_controlTank",value:function(t){this._controlData.THROTTLE=Number(t.THROTTLE),this._controlData.TURN=Number(t.TURN),this._controlData.GUN_TURN=Number(t.GUN_TURN),this._controlData.RADAR_TURN=Number(t.RADAR_TURN),this._controlData.SHOOT=Number(t.SHOOT),this._controlData.DEBUG=t.DEBUG,this._controlData.BOOST=t.BOOST?1:0,this._controlData.THROTTLE=isNaN(this._controlData.THROTTLE)?0:this._controlData.THROTTLE,this._controlData.TURN=isNaN(this._controlData.TURN)?0:this._controlData.TURN,this._controlData.GUN_TURN=isNaN(this._controlData.GUN_TURN)?0:this._controlData.GUN_TURN,this._controlData.RADAR_TURN=isNaN(this._controlData.RADAR_TURN)?0:this._controlData.RADAR_TURN,this._controlData.SHOOT=isNaN(this._controlData.SHOOT)?0:this._controlData.SHOOT,this._controlData.THROTTLE=Math.min(1,Math.max(-1,Number(this._controlData.THROTTLE))),this._controlData.TURN=Math.min(1,Math.max(-1,Number(this._controlData.TURN))),this._controlData.GUN_TURN=Math.min(1,Math.max(-1,Number(this._controlData.GUN_TURN))),this._controlData.RADAR_TURN=Math.min(1,Math.max(-1,Number(this._controlData.RADAR_TURN))),this._controlData.SHOOT=Math.min(1,Math.max(0,Number(this._controlData.SHOOT))),this._tank.setThrottle(this._controlData.THROTTLE),this._tank.setBoost(this._controlData.BOOST),this._tank.setTurn(this._controlData.TURN),this._tank.setRadarTurn(this._controlData.RADAR_TURN),this._tank.setGunTurn(this._controlData.GUN_TURN),this._tank.setDebugData(this._controlData.DEBUG),this._controlData.SHOOT&&this._tank.shoot(this._controlData.SHOOT),this._controlData.SHOOT=0;var e=[];for(var n in t.OUTBOX)e.push(JSON.parse(JSON.stringify(t.OUTBOX[n])));this._tank.team&&this._tank.team.sendMessages(this._tank.id,e),this._controlData.OUTBOX=[]}},{key:"_createWorker",value:function(t){return t.useSandbox?new Worker(t.filePath):new o.default}},{key:"tank",get:function(){return this._tank}},{key:"worker",get:function(){return this._aiWorker}}]),t}();e.default=a},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var extendedMath=__webpack_require__(31),TankController=function(){function t(){_classCallCheck(this,t),this._initCallback=function(){},this._loopCallback=function(){}}return _createClass(t,[{key:"loop",value:function(t){this._loopCallback=t}},{key:"init",value:function(t){this._initCallback=t}}]),t}(),EvalWorker=function(){function EvalWorker(){_classCallCheck(this,EvalWorker),this.onmessage=function(t){},this._callStackLimit=100,this._callStackCount=0,this._tankController=new TankController}return _createClass(EvalWorker,[{key:"postMessage",value:function postMessage(inputData){var _this=this,response=null;if("init"==inputData.command){if(!inputData.code)throw"The code is required!";var settings=inputData.settings,info=inputData.info,Math=extendedMath(),tank=this._tankController;eval(inputData.code),tank._initCallback(settings,info),response={data:{type:"init",settings:settings}}}else if("update"==inputData.command){var state=inputData.state,control=inputData.control;this._tankController._loopCallback?(this._tankController._loopCallback(state,control),response={data:control}):response={data:control}}this._callStackCount<this._callStackLimit?(this._callStackCount++,this.onmessage(response)):(this._callStackCount=0,setTimeout(function(){_this.onmessage(response)},1))}},{key:"terminate",value:function(){}}]),EvalWorker}();exports.default=EvalWorker},function(t,e,n){"use strict";t.exports=function(){var t={},e=["LN10","PI","E","LOG10E","SQRT2","LOG2E","SQRT1_2","LN2","cos","pow","log","tan","sqrt","ceil","asin","abs","max","exp","atan2","random","round","floor","acos","atan","min","sin"];for(var n in e)t[e[n]]=Math[e[n]];return t.deg={},t.rad={},t.deg.normalize=function(t){for(t=Number(t);t>180;)t-=360;for(;t<=-180;)t+=360;return t},t.rad.normalize=function(e){for(e=Number(e);e>t.PI;)e-=2*t.PI;for(;e<=-t.PI;)e+=2*t.PI;return e},t.deg2rad=function(e){return t.rad.normalize(e*(t.PI/180))},t.rad2deg=function(e){return t.deg.normalize(e*(180/t.PI))},t.rad.atan2=t.atan2,t.deg.atan2=function(e,n){return t.rad2deg(t.rad.atan2(e,n))},t.distance=function(e,n,i,r){var o=i-e,a=r-n;return t.sqrt(o*o+a*a)},t.randomRange=function(e,n){if(e>n)throw"The range is incorrect. First number must be lower than second";return e+t.random()*(n-e)},t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._simulationStepDuration=30,this._stepCounter=0,this._checkLoop=0,this._started=!1,this._desiredPerfomance=Math.floor(1e3/this._simulationStepDuration),this._actualPerfomance=this._desiredPerfomance,this._perfomanceIndex=1,this._desiredQuality=1,this._quality=this._desiredQuality,this._checkInterval=500}return i(t,[{key:"start",value:function(){this._started=!0;var t=this;this._checkLoop=setInterval(function(){t._check()},this._checkInterval)}},{key:"stop",value:function(){this._started=!1,this._checkLoop&&(clearInterval(this._checkLoop),this._checkLoop=null)}},{key:"setSimulationStepDuration",value:function(t){t!=this._simulationStepDuration&&(this._quality=this._desiredQuality),this._simulationStepDuration=t,this._desiredPerfomance=Math.floor(1e3/t)}},{key:"onSimulationStep",value:function(){this._started&&this._stepCounter++}},{key:"_check",value:function(){this._actualPerfomance=Math.ceil(this._stepCounter*(1e3/this._checkInterval)),this._stepCounter=0;var t=this._desiredPerfomance?this._actualPerfomance/this._desiredPerfomance:1;this._perfomanceIndex=(this._perfomanceIndex+t)/2,this._updateQuality()}},{key:"_updateQuality",value:function(){var t=2.5*this._perfomanceIndex-1.25;t=Math.max(0,Math.min(1,t));var e=-.5*this._perfomanceIndex+.45;this._perfomanceIndex>1?this._desiredQuality+=.1:this._desiredQuality-=e,this._desiredQuality=Math.max(0,Math.min(1,this._desiredQuality));var n=Math.max(t,this._desiredQuality);this._desiredQuality=(this._desiredQuality+n)/2,this._desiredQuality<this._quality?this._quality=this._desiredQuality:this._quality=(this._desiredQuality+9*this._quality)/10}},{key:"started",get:function(){return this._started}},{key:"desiredPerfomance",get:function(){return this._desiredPerfomance}},{key:"actualPerfomance",get:function(){return this._actualPerfomance}},{key:"qualityLevel",get:function(){return this._quality}}]),t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},o=c(n(7)),a=c(n(36)),s=c(n(37)),l=c(n(38)),u=c(n(39));function c(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._frameCounter=0,t._fpsLabel=null,t._scoreBoard=null,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),i(e,[{key:"initBatlefield",value:function(t){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"initBatlefield",this).call(this,t);var n=new PIXI.TextStyle({fontFamily:"Arial",fontSize:12,fill:"#00ff00"});this._fpsLabel=new PIXI.Text("FPS",n),this._fpsLabel.x=100,this._fpsLabel.y=5,this.stage.addChild(this._fpsLabel);var i=this;setInterval(function(){i._fpsLabel.text="FPS: "+i._frameCounter,i._frameCounter=0},1e3),n=new PIXI.TextStyle({fontFamily:"Arial",fontSize:12,fill:"#00ff00"}),this._scoreBoard=new PIXI.Text("scores",n),this._scoreBoard.x=t.margin+2,this._scoreBoard.y=t.margin+2,this._scoreBoard.alpha=.5,this.stage.addChild(this._scoreBoard)}},{key:"renderTankStats",value:function(t){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"renderTankStats",this).call(this,t);var n=[],i=void 0;for(i=0;i<t.length;i++)n.push({name:t[i].fullName,energy:t[i].energy,value:t[i].score});n.sort(function(t,e){return t.value<e.value?1:t.value>e.value?-1:0});var o="";for(i=0;i<n.length;i++)o+=n[i].value.toFixed(3)+" - "+n[i].name+(0==n[i].energy?" [X]":"")+"\n";this._scoreBoard.text=o}},{key:"postRender",value:function(){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"postRender",this).call(this),this._frameCounter++}},{key:"_createBattlefieldView",value:function(t){return new a.default(t)}},{key:"_createClockView",value:function(t){return new s.default(t)}},{key:"_createBulletView",value:function(t){return new l.default(t)}},{key:"_createTankView",value:function(t){return new u.default(t)}}]),e}();e.default=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=a(n(6)),o=a(n(11));function a(t){return t&&t.__esModule?t:{default:t}}var s=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._tankMap=[],t._bulletMap=[],t._offsetX=0,t._offsetY=0,t._speedMultiplier=1,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),i(e,[{key:"initBatlefield",value:function(t){this._offsetX=t.offsetX,this._offsetY=t.offsetY}},{key:"renderTank",value:function(t,e){this._renderModel(t,e,this._tankMap,this._createTankView)}},{key:"renderBullet",value:function(t,e){this._renderModel(t,e,this._bulletMap,this._createBulletView)}},{key:"getBulletView",value:function(t){return this._bulletMap[t]}},{key:"getTankView",value:function(t){return this._tankMap[t]}},{key:"setSpeed",value:function(t){this._speedMultiplier=t}},{key:"_renderModel",value:function(t,e,n,i){var r=null;return n[t.id]?r=n[t.id]:(r=i(t),n[t.id]=r),r.update(e),r}},{key:"_createTankView",value:function(t){return new o.default(t)}},{key:"_createBulletView",value:function(t){return new o.default(t)}},{key:"offsetX",get:function(){return this._offsetX}},{key:"offsetY",get:function(){return this._offsetY}},{key:"speedMultiplier",get:function(){return this._speedMultiplier}}]),e}();e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return i(t,[{key:"construct",value:function(){this._msElapsed=0,this._msLimit=0}},{key:"update",value:function(t,e){this._msElapsed=t,this._msLimit=e}},{key:"msElapsed",get:function(){return this._msElapsed}},{key:"msLimit",get:function(){return this._msLimit}},{key:"text",get:function(){var t=Math.max(0,this._msLimit-this._msElapsed),e=Math.floor(t/1e3),n=t%1e3;for(e=e.toString();e.length<2;)e="0"+e;for(n=n.toString();n.length<3;)n="0"+n;return"0:"+e+"."+n}}]),t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(1));var o=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),i(e,[{key:"_create",value:function(t){var e=new PIXI.Graphics;e.beginFill(0),e.lineStyle(1,16776960,.8),e.drawRect(0,0,this.model.width+2*this.model.margin,this.model.height+2*this.model.margin),e.endFill(),t.addChild(e),(e=new PIXI.Graphics).beginFill(0),e.lineStyle(1,16776960,.8),e.drawRect(this.model.margin,this.model.margin,this.model.width,this.model.height),e.endFill(),t.addChild(e)}},{key:"update",value:function(t){}}]),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(1));var o=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),i(e,[{key:"_create",value:function(t){var e=new PIXI.TextStyle({fontFamily:"Arial",fontSize:12,fill:"#00ff00"});this._label=new PIXI.Text("clock",e),this._label.x=5,this._label.y=5,t.addChild(this._label)}},{key:"update",value:function(t){this._label.text=this.model.text}}]),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(8));var o=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),i(e,[{key:"_create",value:function(t){var e=new PIXI.Graphics;e.beginFill(65280,.5),e.drawCircle(0,0,5),e.endFill(),t.addChild(e)}}]),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(4));var o=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),i(e,[{key:"_createBody",value:function(){var t=new PIXI.Graphics;return t.lineStyle(1,16776960,.8),t.beginFill(65280,.5),t.drawRect(-15,-15,30,30),t.endFill(),t}},{key:"_createGun",value:function(){var t=new PIXI.Graphics;return t.beginFill(65280,.5),t.lineStyle(1,16776960,.8),t.drawCircle(0,0,10),t.drawRect(0,-3,30,6),t.endFill(),t}},{key:"_createRadar",value:function(){var t=new PIXI.Graphics;t.beginFill(65280,.5),t.lineStyle(1,16776960,.8),t.drawRect(-3,-10,6,20),t.endFill(),t.lineStyle(),t.beginFill(11206570,.1),t.moveTo(0,-3);var e=300*Math.tan(Math.PI/180*6)/2;return t.lineTo(300,-e),t.lineTo(300,e),t.lineTo(0,3),t}},{key:"_createLabel",value:function(){var t=new PIXI.TextStyle({fontFamily:"Arial",fontSize:12,fill:65280}),e=new PIXI.Text("",t);return e.anchor.set(.5,.5),e.x=0,e.y=-40,e}},{key:"_createHudBackground",value:function(){var t=new PIXI.Graphics;return t.beginFill(0,1),t.lineStyle(1,16776960,.8),t.drawRect(-26,-3,52,6),t.y=-30,t}},{key:"_createEnergyBar",value:function(){var t=new PIXI.Graphics;return t.beginFill(65280,1),t.drawRect(0,-2,50,4),t.x=-25,t.y=-30,t}}]),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},o=c(n(7)),a=c(n(41)),s=c(n(42)),l=c(n(43)),u=c(n(44));function c(t){return t&&t.__esModule?t:{default:t}}var h=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"bw"));return t._bigBoomAnim=[],t._smallBoomAnim=[],t._shakeTimer=0,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),i(e,[{key:"onAssetsLoaded",value:function(){for(var t=0;t<=9;t++)this._bigBoomAnim.push(PIXI.Texture.fromFrame("big_boom_00"+t)),this._smallBoomAnim.push(PIXI.Texture.fromFrame("small_boom_00"+t))}},{key:"initBatlefield",value:function(t){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"initBatlefield",this).call(this,t)}},{key:"renderTank",value:function(t,n){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"renderTank",this).call(this,t,n),0==t.energy&&(this._shakeTimer=10,this._addExplosion(t.x,t.y,this._bigBoomAnim))}},{key:"renderBullet",value:function(t,n){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"renderBullet",this).call(this,t,n),t.exploded&&this._addExplosion(t.x,t.y,this._smallBoomAnim)}},{key:"postRender",value:function(){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"postRender",this).call(this),this._shakeTimer>0?(this._shakeTimer--,this.masterContainer.x=10*Math.random()-5-this.offsetX,this.masterContainer.y=10*Math.random()-5-this.offsetY):(this.masterContainer.x=-this.offsetX,this.masterContainer.y=-this.offsetY)}},{key:"_createBattlefieldView",value:function(t){return new a.default(t)}},{key:"_createClockView",value:function(t){return new s.default(t)}},{key:"_createBulletView",value:function(t){return new l.default(t)}},{key:"_createTankView",value:function(t){return new u.default(t)}},{key:"_addExplosion",value:function(t,e,n){var i=new PIXI.extras.AnimatedSprite(n);i.anchor.set(.5),this.masterContainer.addChild(i),i.x=t,i.y=e,i.loop=!1,i.onComplete=function(){this.stop(),this.parent.removeChild(this)},i.play()}}]),e}();e.default=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(1));var o=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),i(e,[{key:"_create",value:function(t){var e=PIXI.Sprite.fromFrame("battlefield");t.addChild(e)}},{key:"update",value:function(t){}}]),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(1));var o=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),i(e,[{key:"_create",value:function(t){var e=new PIXI.TextStyle({fontFamily:"Arial",fontSize:15,fill:"#000000"});this._label=new PIXI.Text("clock",e),this._label.x=10,this._label.y=580,t.addChild(this._label)}},{key:"update",value:function(t){this._label.text=this.model.text}}]),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(8));var o=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),i(e,[{key:"_create",value:function(t){var e=PIXI.Sprite.fromFrame("bullet");e.anchor.set(.5),t.addChild(e)}}]),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(4));var o=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),i(e,[{key:"update",value:function(t){(function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0})(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,t),this._shoot.alpha=this.model.isShooting?1:.7*this._shoot.alpha}},{key:"_createBody",value:function(){var t=PIXI.Sprite.fromFrame("tank_body");return t.anchor.set(.5),t}},{key:"_createGun",value:function(){var t=new PIXI.Container,e=PIXI.Sprite.fromFrame("tank_gun");return e.anchor.set(.3,.5),t.addChild(e),this._shoot=PIXI.Sprite.fromFrame("tank_shoot"),this._shoot.anchor.set(-1.2,.5),this._shoot.alpha=0,t.addChild(this._shoot),t}},{key:"_createRadar",value:function(){var t=PIXI.Sprite.fromFrame("tank_radar");return t.anchor.set(.5),t}},{key:"_createLabel",value:function(){var t=new PIXI.TextStyle({fontFamily:"Arial",fontSize:12,fill:0}),e=new PIXI.Text("",t);return e.anchor.set(.5,.5),e.x=0,e.y=-40,e}},{key:"_createHudBackground",value:function(){var t=new PIXI.Graphics;return t.beginFill(0,1),t.drawRect(-26,-3,52,6),t.y=-30,t}},{key:"_createEnergyBar",value:function(){var t=new PIXI.Graphics;return t.beginFill(16711680,1),t.drawRect(0,-2,50,4),t.x=-25,t.y=-30,t}}]),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},o=h(n(7)),a=h(n(46)),s=h(n(47)),l=h(n(48)),u=h(n(49)),c=h(n(50));function h(t){return t&&t.__esModule?t:{default:t}}var f=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"brody"));return t._bigBoomAnim=[],t._shakeTimer=0,t._particleContainer=null,t._particleList=[],t._explosionList=[],t._settings=new c.default,t._masterContainer.addChild(t._bulletContainer),t._frameTimer=0,t._frameCounter=0,t._fpsInterval=null,t._fps=30,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),i(e,[{key:"onAssetsLoaded",value:function(){var t=void 0;for(t=0;t<=22;t++)this._bigBoomAnim.push(PIXI.Texture.fromFrame("big_boom_0"+(t<10?"0"+t:t)))}},{key:"initBatlefield",value:function(t){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"initBatlefield",this).call(this,t),this.battlefieldView.configure(this._settings),this._particleContainer=new PIXI.particles.ParticleContainer(1e3,{position:!0,rotation:!0,alpha:!0}),this._masterContainer.addChild(this._particleContainer),this._masterContainer.addChild(this._hudContainer);var n=this;this._fpsInterval=setInterval(function(){n._fps=n._frameCounter,n._frameCounter=0},1e3)}},{key:"renderTank",value:function(t,n){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"renderTank",this).call(this,t,n);var i=void 0;for(i in n)if("destroy"==n[i].type){this._shakeTimer=10,this._addTankExplosion(t);break}var o=t.throttle>0?180:0,a=(t.angle+o)*(Math.PI/180);if(t.speed>1){var s=t.x+20*Math.cos(a-Math.PI/4)+7*Math.cos(a),l=t.y+20*Math.sin(a-Math.PI/4)+7*Math.sin(a),u=t.x+20*Math.cos(a+Math.PI/4)+7*Math.cos(a),c=t.y+20*Math.sin(a+Math.PI/4)+7*Math.sin(a);Math.random()<this.speedMultiplier&&(this._addDirt(s,l),this._addDirt(u,c))}}},{key:"renderBullet",value:function(t,n){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"renderBullet",this).call(this,t,n),this.getBulletView(t.id).configure(this._settings),t.exploded&&(this._addBulletExplosion(t),this.battlefieldView.addBulletHole(t.x,t.y,t.power))}},{key:"preRender",value:function(){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"preRender",this).call(this);var t=void 0,n=0,i=void 0;for(i=this._particleList.length-1;i>=0;i--)(t=this._particleList[i])&&(t.x+=this.speedMultiplier*t.speed*t.rotation*Math.cos(t.rotation),t.y+=this.speedMultiplier*t.speed*t.rotation*Math.sin(t.rotation),t.alpha=Math.max(0,t.alpha-this.speedMultiplier*t.alphaSpeed),t.lifetime-=this.speedMultiplier,t.lifetime<=0||n>this._settings.particleLimit?(t.parent.removeChild(t),this._particleList[i]=null):n++);for(i=0;i<this._explosionList.length;i++)this._explosionList[i]&&(this._explosionList[i].alpha=this._explosionList[i].alpha-.12*this.speedMultiplier,this._explosionList[i].alpha<.01&&(this._explosionList[i].parent.removeChild(this._explosionList[i]),this._explosionList[i]=null))}},{key:"postRender",value:function(){this._frameTimer++,this._frameCounter++,this._frameTimer%this._settings.dropFrames==0&&r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"postRender",this).call(this),this._shakeTimer>0?(this._shakeTimer--,this.masterContainer.x=10*Math.random()-5-this.offsetX,this.masterContainer.y=10*Math.random()-5-this.offsetY,this._battlefieldView.view.x=10*Math.random()-5,this._battlefieldView.view.y=10*Math.random()-5):(this.masterContainer.x=-this.offsetX,this.masterContainer.y=-this.offsetY,this._battlefieldView.view.x=0,this._battlefieldView.view.y=0)}},{key:"stop",value:function(){this._fpsInterval&&clearInterval(this._fpsInterval)}},{key:"_getSpritesheetUrls",value:function(t,e){return e>=2?["img/spritesheets/"+t+"/retina@2x/jsbattle_0.json","img/spritesheets/"+t+"/retina@2x/jsbattle_1.json"]:["img/spritesheets/"+t+"/web/jsbattle.json"]}},{key:"_addTankExplosion",value:function(t){this._addExplosion(t.x,t.y,this._bigBoomAnim),this.battlefieldView.addCrater(t.x,t.y),this._addSparks(t.x,t.y,300)}},{key:"_addBulletExplosion",value:function(t){this._addGlow(t.x,t.y,.3+.6*t.power);var e=5+40*t.power;this._addSparks(t.x,t.y,e)}},{key:"_createBattlefieldView",value:function(t){return new a.default(t)}},{key:"_createClockView",value:function(t){return new s.default(t)}},{key:"_createBulletView",value:function(t){return new l.default(t)}},{key:"_createTankView",value:function(t){return new u.default(t)}},{key:"_addExplosion",value:function(t,e,n){this._addGlow(t,e,5);var i=new PIXI.extras.AnimatedSprite(n);i.animationSpeed=this.speedMultiplier,i.anchor.set(.5),this.masterContainer.addChild(i),i.x=t,i.y=e,i.loop=!1,i.blendMode=PIXI.BLEND_MODES.ADD,i.onComplete=function(){this.stop(),this.parent.removeChild(this)},i.play()}},{key:"_addGlow",value:function(t,e,n){if(this._settings.showGlow){var i=PIXI.Sprite.fromFrame("glow");i.anchor.set(.5),i.scale.x=i.scale.y=n,i.alpha=.4,i.blendMode=PIXI.BLEND_MODES.ADD,i.x=t,i.y=e,this.masterContainer.addChild(i),this._explosionList.push(i)}}},{key:"_addSparks",value:function(t,e,n){n=Math.ceil(n*this._settings.quality);for(var i=0;i<n;i++){var r=PIXI.Sprite.fromFrame("spark");r.x=t,r.y=e,r.alphaSpeed=0,r.anchor.set(.5),r.speed=1+2*Math.random(),r.rotation=2*Math.random()*Math.PI,r.lifetime=5+5*Math.random(),this._particleContainer.addChild(r),this._particleList.push(r)}}},{key:"_addDirt",value:function(t,e){if(this._settings.showDirt)for(var n=0;n<5;n++){var i=Math.floor(3*Math.random()),r=PIXI.Sprite.fromFrame("dirt_"+i);r.x=t+4*Math.random()-2,r.y=e+4*Math.random()-2,r.anchor.set(.5),r.speed=0,r.alphaSpeed=.02+.02*Math.random(),r.rotation=0,r.alpha=.1+.4*Math.random(),r.lifetime=25,r.scale.x=r.scale.y=.5+2*Math.random(),this._particleContainer.addChild(r),this._particleList.push(r)}}},{key:"quality",get:function(){return this._settings.quality},set:function(t){this._settings.quality=t}}]),e}();e.default=f},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(1));var o=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._holeList=[],n._settings=null,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),i(e,[{key:"configure",value:function(t){this._settings=t}},{key:"_create",value:function(t){var e=PIXI.Sprite.fromFrame("battlefield");t.addChild(e);var n=new PIXI.Graphics;n.beginFill(255,1),n.moveTo(25,25),n.lineTo(875,25),n.lineTo(875,575),n.lineTo(90,575),n.lineTo(90,565),n.lineTo(25,565),n.lineTo(25,25),n.endFill(),this._craterContainer=new PIXI.Container,this._craterContainer.mask=n,t.addChild(this._craterContainer),t.addChild(n);var i=new PIXI.Graphics;i.beginFill(255,.4),i.moveTo(15,15),i.lineTo(885,15),i.lineTo(885,585),i.lineTo(80,585),i.lineTo(80,575),i.lineTo(15,575),i.lineTo(15,15),i.lineTo(25,25),i.lineTo(25,575),i.lineTo(80,575),i.lineTo(80,575),i.lineTo(875,575),i.lineTo(875,25),i.lineTo(25,25),i.endFill(),this._holesContainer=new PIXI.Container,this._holesContainer.mask=i,t.addChild(this._holesContainer),t.addChild(i)}},{key:"addCrater",value:function(t,e){var n=PIXI.Sprite.fromFrame("crater");n.anchor.set(.5),n.x=t-this.model.offsetX,n.y=e-this.model.offsetY,n.blendMode=PIXI.BLEND_MODES.MULTIPLY,n.alpha=.8,this._craterContainer.addChild(n)}},{key:"update",value:function(){(function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0})(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this._holesContainer.visible=this._settings.skratchLimit>0,this._craterContainer.visible=this._settings.showCraters}},{key:"addBulletHole",value:function(t,e,n){var i=0;if(Math.abs(e-this.model.maxY)<10)e=this.model.maxY+3+3*Math.random();else if(Math.abs(e-this.model.minY)<10)e=this.model.minY-3-3*Math.random();else if(Math.abs(t-this.model.maxX)<10)t=this.model.maxX+3+3*Math.random(),i=Math.PI/2;else{if(!(Math.abs(t-this.model.minX)<10))return;t=this.model.minX-3-3*Math.random(),i=Math.PI/2}var r=PIXI.Sprite.fromFrame("hole");r.anchor.set(.5),r.x=t-this.model.offsetX,r.y=e-this.model.offsetY,r.rotation=i,r.scale.x=r.scale.y=.7+.5*n,this._holesContainer.addChild(r),this._holeList.push(r);for(var o=this._settings?this._settings.skratchLimit:20;this._holeList.length>o;)(r=this._holeList.shift()).parent.removeChild(r)}}]),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(1));var o=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),i(e,[{key:"_create",value:function(t){var e=new PIXI.TextStyle({fontFamily:"Arial",fontSize:15,fill:"#000000"});this._label=new PIXI.Text("clock",e),this._label.x=10,this._label.y=580,t.addChild(this._label)}},{key:"update",value:function(t){this._label.text=this.model.text}}]),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(8));var o=function(t){function e(t,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),i(e,[{key:"configure",value:function(t){this._settings=t}},{key:"update",value:function(t){(function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0})(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,t),this._glow.visible=this._settings&&this._settings.showGlow}},{key:"_create",value:function(t){var e=PIXI.Sprite.fromFrame("bullet");e.anchor.set(.5);var n=PIXI.Sprite.fromFrame("glow");n.anchor.set(.5),n.blendMode=PIXI.BLEND_MODES.ADD,n.alpha=.1,this._glow=n,t.addChild(n),t.addChild(e)}}]),e}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},o=function(t){return t&&t.__esModule?t:{default:t}}(n(4));var a=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._lightTimer=0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o.default),i(e,[{key:"update",value:function(t){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,t),this._shoot.alpha=.8*this._shoot.alpha,this._tankGun.x=.8*this._tankGun.x,this.radar.rotation=(-this.model.gunAngle+this._model.radarAngle)*(Math.PI/180),this._lightTimer=this.model.enemySpot?this._lightTimer+1:0,this._light.alpha=.5*-Math.cos(.25*this._lightTimer)+.5}},{key:"_onShoot",value:function(t){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onShoot",this).call(this,t),this._tankGun.x=-1-3*t.bullet.power,this._shoot.alpha=1}},{key:"_create",value:function(t){r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_create",this).call(this,t),this._tankGun.addChild(this.radar)}},{key:"_createBody",value:function(){var t=PIXI.Sprite.fromFrame("tank_body_"+this.model.skin);return t.anchor.set(.3,.5),t}},{key:"_createGun",value:function(){var t=new PIXI.Container,e=PIXI.Sprite.fromFrame("tank_gun_"+this.model.skin);return e.anchor.set(.3,.5),t.addChild(e),this._tankGun=e,this._shoot=PIXI.Sprite.fromFrame("tank_shoot"),this._shoot.anchor.set(.3,.5),this._shoot.alpha=0,this._light=PIXI.Sprite.fromFrame("tank_light"),this._light.anchor.set(.3,.5),this._light.alpha=0,t.addChild(this._shoot),t.addChild(this._light),t}},{key:"_createRadar",value:function(){var t=PIXI.Sprite.fromFrame("tank_radar_"+this.model.skin);return t.anchor.set(.2,.5),t.x=-5,t}},{key:"_createLabel",value:function(){var t=new PIXI.TextStyle({fontFamily:"Arial",fontSize:10,stroke:0,strokeThickness:2,fill:16777147}),e=new PIXI.Text("",t);return e.anchor.set(.5,.5),e.x=0,e.y=-40,e}},{key:"_createHudBackground",value:function(){var t=new PIXI.Graphics;return t.beginFill(0,1),t.drawRect(-26,-3,52,6),t.y=-30,t}},{key:"_createEnergyBar",value:function(){var t=new PIXI.Graphics;return t.beginFill(16777113,1),t.drawRect(0,-2,50,4),t.x=-25,t.y=-30,t}}]),e}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._particleLimit=1e3,this._skratchLimit=100,this._showDirt=!0,this._showGlow=!0,this._showCraters=!0,this._dropFrames=1,this._quality=1,this.quality=this._quality}return i(t,[{key:"dropFrames",get:function(){return this._dropFrames}},{key:"particleLimit",get:function(){return this._particleLimit}},{key:"skratchLimit",get:function(){return this._skratchLimit}},{key:"showDirt",get:function(){return this._showDirt}},{key:"showGlow",get:function(){return this._showGlow}},{key:"showCraters",get:function(){return this._showCraters}},{key:"quality",get:function(){return this._quality},set:function(t){t=Math.min(1,Math.max(0,t)),this._quality=t,this._particleLimit=Math.round(1e3*t*t),this._skratchLimit=Math.round(100*t),this._showDirt=t>.2,this._showGlow=t>.5,this._showCraters=t>.1,this._dropFrames=t>.3?1:t>.2?2:t>.1?3:4,this._quality=t}}]),t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(t){return t&&t.__esModule?t:{default:t}}(n(6));var o=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r.default),i(e,[{key:"renderTank",value:function(t,e){}},{key:"renderBullet",value:function(t,e){}},{key:"loadAssets",value:function(t){t()}},{key:"init",value:function(){}}]),e}();e.default=o}]);
//# sourceMappingURL=jsbattle.min.js.map